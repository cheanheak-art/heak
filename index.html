<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo List</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    .margin {
      margin-left: 10px;
      margin-right: 10px;
    }
  </style>
</head>

<body>
  <div class="container-lg mt-4">
    <h1 class="text-center text-primary mb-3">ToDo List</h1>

    <!-- Input -->
    <div class="d-flex justify-content-center mb-3">
      <label class="text-info fs-5 me-2">To Do :</label>

      <input
        id="todo_input"
        class="form-control w-50 me-2"
        placeholder="Input your todo"
        type="text"
      />

      <input type="button" class="btn btn-success" id="btn_add" />
    </div>

    <!-- Result Table -->
    <div class="d-flex justify-content-center">
      <table class="table table-hover text-center w-75">
        <tbody id="todoTable"></tbody>
      </table>
    </div>
  </div>

  <script>
    let todo_input = document.getElementById("todo_input");
    let btn_add = document.getElementById("btn_add");
    let todoTable = document.getElementById("todoTable");

    let list = [];
    let index = -1;
    let status = "Add";

    btn_add.value = status;
    todo_input.focus();

    // Add / Update
    btn_add.addEventListener("click", function () {
      if (!todo_input.value.trim()) {
        alert("Please input task");
        return;
      }

      // Check duplicate
      for (let i = 0; i < list.length; i++) {
        if (list[i].task === todo_input.value && index !== i) {
          alert("Task already exists!");
          clearForm();
          return;
        }
      }

      if (status === "Add") {
        list.push({
          id: list.length + 1,
          task: todo_input.value,
          isDone: false,
        });
      } else {
        list[index].task = todo_input.value;
        list[index].isDone = false;
        index = -1;
        status = "Add";
        btn_add.value = status;
      }

      render();
      clearForm();
    });

    // Enter key
    todo_input.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        btn_add.click();
      }
    });

    // Render table
    function render() {
      let html = "";

      for (let item of list) {
        if (item.isDone) {
          html += `
          <tr class="align-middle">
            <td><del>${item.id}</del></td>
            <td><del>${item.task}</del></td>
            <td>
              <button class="btn btn-success btn-sm" onclick="undoneTask(${item.id})">ğŸ”™</button>
              <button class="btn btn-light btn-sm" onclick="editTask(${item.id})">âœï¸</button>
              <button class="btn btn-warning btn-sm" onclick="deleteTask(${item.id})">ğŸ—‘</button>
            </td>
          </tr>`;
        } else {
          html += `
          <tr class="align-middle">
            <td>${item.id}</td>
            <td>${item.task}</td>
            <td>
              <button class="btn btn-success btn-sm" onclick="doneTask(${item.id})">âœ”ï¸</button>
              <button class="btn btn-light btn-sm" onclick="editTask(${item.id})">âœï¸</button>
              <button class="btn btn-warning btn-sm" onclick="deleteTask(${item.id})">ğŸ—‘</button>
            </td>
          </tr>`;
        }
      }

      todoTable.innerHTML = html;
    }

    function clearForm() {
      todo_input.value = "";
      todo_input.focus();
    }

    // Delete
    function deleteTask(id) {
      if (confirm("Are you sure you want to delete task?")) {
        index = findIndex(id);
        list.splice(index, 1);
        updateNumber(); // â­ renumber
        render();
        index = -1;
      }
    }

    // Edit
    function editTask(id) {
      index = findIndex(id);
      status = "âœï¸";
      btn_add.value = status;
      todo_input.value = list[index].task;
      todo_input.focus();
    }

    // Done / Undone
    function doneTask(id) {
      index = findIndex(id);
      list[index].isDone = true;
      render();
      index = -1;
    }

    function undoneTask(id) {
      index = findIndex(id);
      list[index].isDone = false;
      render();
      index = -1;
    }

    function findIndex(id) {
      for (let i = 0; i < list.length; i++) {
        if (list[i].id === id) return i;
      }
    }

    // â­ Renumber after delete
    function updateNumber() {
      for (let i = 0; i < list.length; i++) {
        list[i].id = i + 1;
      }
    }
  </script>
</body>
</html>
